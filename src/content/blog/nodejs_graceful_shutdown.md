---
author: Patrik Kaura
pubDatetime: 2023-02-24T21:46:00Z
title: Graceful shutdown in NodeJS
postSlug: graceful-shutdown-in-nodejs
featured: false
draft: false
tags:
  - nodejs
  - web-development
ogImage: ""
description: NodeJS graceful shutdown.
---

## Description

"Graceful shutdown" refers to a state where `all the requests to
a server have been responded` to, and there is `no data processing
work left`. To achieve a graceful shutdown, the following four steps
can be taken:

1. Handle the process `kill signal` - A signal is an asynchronous notification sent to a process or a specific thread to notify an event that occurred.
2. `Stop accepting` new requests from clients.
3. `Close all` data processing.
4. `Exit` the process.

The signal generated by clicking `<Ctrl>+C` in the terminal is
`SIGINT`. On the other hand, the `SIGTERM` signal is a generic signal
that can be used to cause program termination. Unlike `SIGKILL`,
this signal can be blocked, handled, and ignored. It is the standard way
to ask a program to terminate politely.

![L4 code](/assets/nodejs/graceful-shutdown.png)

## Example

```javascript
const express = require("express");
const mongoose = require("mongoose");

const app = express();

// db connection
mongoose.connect("mongodb://localhost/test", err => {});

// http server route
app.post("/api/test", async (req, res) => {
  return { data: "hello" };
});

const server = app.listen(3000);

// process listen for SIGTERM (1.)
process.on("SIGTERM", () => {
  console.info("SIGTERM signal received.");
  console.log("Closing http server.");

  // stop receiving new requests (2.)
  server.close(() => {
    // disconnect mongo db (3.)
    mongoose.connection.close(false, () => {
      // finally kill process (4.)
      process.exit(0);
    });
  });
});
```

### Sources

- Graceful shutdown with Node.js and Kubernetes - https://blog.risingstack.com/graceful-shutdown-node-js-kubernetes/
